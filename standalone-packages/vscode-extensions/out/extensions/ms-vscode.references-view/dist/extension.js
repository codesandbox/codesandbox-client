module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=require("vscode")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(2);class s{constructor(e,t,n,i,r,o){this.id=e,this.uri=t,this.position=n,this.preview=i,this.word=r,this.line=o}}t.HistoryItem=s;class a{constructor(){this._items=new Map}get isEmpty(){return 0==this._items.size}*[Symbol.iterator](){let e=[...this._items.values()];for(let t=e.length-1;t>=0;t--)yield e[t]}add({uri:e,position:t}){return i(this,void 0,void 0,function*(){let n;try{n=yield r.workspace.openTextDocument(e)}catch(e){return}const i=n.getWordRangeAtPosition(t);if(!i)return;const c=a._makeId(e,i.start);let{before:l,inside:u,after:d}=o.getPreviewChunks(n,i);l=l.replace(/s$/g,String.fromCharCode(160)),d=d.replace(/^s/g,String.fromCharCode(160));let h=`[${u}](command:references-view.refind?${encodeURIComponent(JSON.stringify([c]))} "${`${r.workspace.asRelativePath(e)}:${t.line+1}:${t.character+1}`}")`;this._items.delete(c),this._items.set(c,new s(c,e,t,l+h+d,u,l+u+d))})}get(e){return this._items.get(e)}static _makeId(e,t){return Buffer.from(e.toString()+t.line+t.character).toString("base64")}}t.History=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(3),s=n(1);function a(e,t,n=8,i=!0){let o=t.start.with({character:Math.max(0,t.start.character-n)}),s=e.getWordRangeAtPosition(o),a=e.getText(new r.Range(s?s.start:o,t.start)),c=e.getText(t),l=t.end.translate(0,331),u=e.getText(new r.Range(t.end,l));return i&&(a=a.replace(/^\s*/g,""),u=u.replace(/\s*$/g,"")),{before:a,inside:c,after:u}}t.getPreviewChunks=a;t.DataProvider=class{constructor(e){this._onDidChangeTreeData=new r.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._onDidReturnEmpty=new r.EventEmitter,this.onDidReturnEmpty=this._onDidReturnEmpty.event,this._history=e}setModelCreation(e){this._modelListener&&this._modelListener.dispose(),this._modelCreation=e,this._onDidChangeTreeData.fire(),e&&e.then(t=>{t&&e===this._modelCreation&&(this._modelListener=t.onDidChange(e=>this._onDidChangeTreeData.fire(e instanceof o.FileItem?e:void 0)))})}getTreeItem(e){return i(this,void 0,void 0,function*(){if(e instanceof o.FileItem){const t=new r.TreeItem(e.uri);return t.contextValue="file-item",t.description=!0,t.iconPath=r.ThemeIcon.File,t.collapsibleState=r.TreeItemCollapsibleState.Collapsed,t}if(e instanceof o.ReferenceItem){const{range:t}=e.location,n=yield e.parent.getDocument(!0),{before:i,inside:o,after:s}=a(n,t),c={label:i+o+s,highlights:[[i.length,i.length+o.length]]},l=new r.TreeItem2(c);return l.collapsibleState=r.TreeItemCollapsibleState.None,l.contextValue="reference-item",l.command={title:"Open Reference",command:"references-view.show",arguments:[e]},l}if(e instanceof s.HistoryItem){const t=new r.TreeItem(e.word);return t.description=`${r.workspace.asRelativePath(e.uri)} • ${e.line}`,t.collapsibleState=r.TreeItemCollapsibleState.None,t.contextValue="history-item",t.command={title:"Show Location",command:"references-view.show",arguments:[e]},t}throw new Error})}getChildren(e){return i(this,void 0,void 0,function*(){if(e instanceof o.FileItem)return e.results;if(this._modelCreation){const e=yield this._modelCreation;return e&&0!==e.items.length?e.items:[...this._history]}return this._onDidReturnEmpty.fire(this),[...this._history]})}getParent(e){return e instanceof o.ReferenceItem?e.parent:void 0}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);class o{constructor(e,t,n){this.uri=e,this.results=t,this.parent=n}getDocument(e){if(this._document||(this._document=r.workspace.openTextDocument(this.uri)),e){const e=this.parent.move(this,!0);e&&!e.parent._document&&this._document.then(()=>e.parent.getDocument(!1))}return this._document}}t.FileItem=o;class s{constructor(e,t){this.location=e,this.parent=t}}t.ReferenceItem=s;class a{constructor(e,t,n){let i;this.uri=e,this.position=t,this._onDidChange=new r.EventEmitter,this.onDidChange=this._onDidChange.event,this.items=[],n.sort(a._compareLocations);for(const e of n)i&&i.uri.toString()===e.uri.toString()||(i=new o(e.uri,[],this),this.items.push(i)),i.results.push(new s(e,i))}static create(e,t){return i(this,void 0,void 0,function*(){let n=yield r.commands.executeCommand("vscode.executeReferenceProvider",e,t);if(n)return new a(e,t,n)})}get total(){let e=0;for(const t of this.items)e+=t.results.length;return e}get(e){for(const t of this.items)if(t.uri.toString()===e.toString())return t}first(){for(const e of this.items)if(e.uri.toString()===this.uri.toString()){for(const t of e.results)if(t.location.range.contains(this.position))return t;return}}remove(e){e instanceof o?(a._del(this.items,e),this._onDidChange.fire(this)):e instanceof s&&(a._del(e.parent.results,e),0===e.parent.results.length?(a._del(this.items,e.parent),this._onDidChange.fire(this)):this._onDidChange.fire(e.parent))}move(e,t){const n=t?1:-1,i=e=>{const t=(this.items.indexOf(e)+n+this.items.length)%this.items.length;return this.items[t]};if(e instanceof o)return t?e.results[0]:a._tail(i(e).results);if(e instanceof s){const t=e.parent.results.indexOf(e)+n;return t<0?a._tail(i(e.parent).results):t>=e.parent.results.length?i(e.parent).results[0]:e.parent.results[t]}}static _compareLocations(e,t){return e.uri.toString()<t.uri.toString()?-1:e.uri.toString()>t.uri.toString()?1:e.range.start.isBefore(t.range.start)?-1:e.range.start.isAfter(t.range.start)?1:0}static _del(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}static _tail(e){return e[e.length-1]}}t.Model=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(1),s=n(3),a=n(2),c=n(5);t.activate=function(e){const t="references-view.tree",n=new o.History,l=new a.DataProvider(n),u=r.window.createTreeView(t,{treeDataProvider:l,showCollapseAll:!0}),d=new c.EditorHighlights;let h;r.window.onDidChangeActiveTextEditor(()=>u.visible&&d.show(),e.subscriptions),u.onDidChangeVisibility(e=>e.visible?d.show():d.hide(),e.subscriptions);const m=()=>{let e;n.isEmpty?e=new r.MarkdownString("No results found."):(e=new r.MarkdownString).value="No results found, run a previous search again:",u.message=e},f=()=>{h&&(1===h.total&&1===h.items.length?u.message=new r.MarkdownString(`${h.total} result in ${h.items.length} file`):1===h.total?u.message=new r.MarkdownString(`${h.total} result in ${h.items.length} files`):1===h.items.length?u.message=new r.MarkdownString(`${h.total} results in ${h.items.length} file`):u.message=new r.MarkdownString(`${h.total} results in ${h.items.length} files`))},g=e=>i(this,void 0,void 0,function*(){yield r.commands.executeCommand("setContext","reference-list.isActive",!0),r.commands.executeCommand(`${t}.focus`),d.setModel(void 0),u.message=void 0;const n=e();if(l.setModelCreation(n),!n)return m();if(h=yield n,r.commands.executeCommand("setContext","reference-list.hasResult",Boolean(h)),!h||0===h.items.length)return m();d.setModel(h);const i=h.first();return i&&u.visible&&u.reveal(i,{select:!0,focus:!0}),f(),h}),v=(e,t)=>i(this,void 0,void 0,function*(){const i=yield g(()=>{if(e instanceof r.Uri&&t instanceof r.Position)return s.Model.create(e,t);if(r.window.activeTextEditor){let e=r.window.activeTextEditor;if(e.document.getWordRangeAtPosition(e.selection.active))return s.Model.create(e.document.uri,e.selection.active)}});i&&n.add(i)}),p=e=>{if(e instanceof o.HistoryItem)return v(e.uri,e.position)},w=(e,t)=>{if(e instanceof s.ReferenceItem){const{location:n}=e;r.window.showTextDocument(n.uri,{selection:n.range.with({end:n.range.start}),preserveFocus:!t})}else e instanceof o.HistoryItem&&r.window.showTextDocument(e.uri,{selection:new r.Range(e.position,e.position),preserveFocus:!1})},_=e=>{if(!h)return;const t=u.selection[0]||h.first();if(t instanceof o.HistoryItem)return;const n=h.move(t,e);n&&(u.reveal(n,{select:!0}),w(n,!0))},y=e=>i(this,void 0,void 0,function*(){let t="",n=[e];for(;n.length>0;){let e=n.pop();if(e instanceof s.Model)n.push(...e.items.slice(0,99));else if(e instanceof s.ReferenceItem){let n=yield e.parent.getDocument(),i=a.getPreviewChunks(n,e.location.range,21,!1);t+=`  ${e.location.range.start.line+1},${e.location.range.start.character+1}:${i.before+i.inside+i.after}\n`}else e instanceof s.FileItem&&(t+=`${r.workspace.asRelativePath(e.uri)}\n`,n.push(...e.results))}t&&(yield r.env.clipboard.writeText(t))}),C=(e,t,n)=>i(this,void 0,void 0,function*(){yield g(()=>Promise.resolve(new s.Model(e,t,n)))});let x;const b="references.preferredLocation";function D(e){if(e&&!e.affectsConfiguration(b))return;const t=r.workspace.getConfiguration().get(b);x&&(x.dispose(),x=void 0),"view"===t&&(x=r.commands.registerCommand("editor.action.showReferences",C))}D(),e.subscriptions.push(u,r.workspace.onDidChangeConfiguration(D),r.commands.registerCommand("references-view.find",v),r.commands.registerCommand("references-view.refind",p),r.commands.registerCommand("references-view.refresh",()=>i(this,void 0,void 0,function*(){if(h)return v(h.uri,h.position)})),r.commands.registerCommand("references-view.clear",()=>i(this,void 0,void 0,function*(){r.commands.executeCommand("setContext","reference-list.hasResult",!1),d.setModel(void 0),l.setModelCreation(void 0);let e=l.onDidReturnEmpty(()=>{e.dispose();let t=new r.MarkdownString;t.value="To populate this view, open an editor and run the 'Find All References'-command or run a previous search again:",u.message=t})})),r.commands.registerCommand("references-view.show",w),r.commands.registerCommand("references-view.remove",e=>{if(h){const t=h.move(e,!0);h.remove(e),d.refresh(),f(),t&&u.reveal(t,{select:!0})}}),r.commands.registerCommand("references-view.next",()=>_(!0)),r.commands.registerCommand("references-view.prev",()=>_(!1)),r.commands.registerCommand("references-view.copy",y),r.commands.registerCommand("references-view.copyAll",()=>y(h)),r.commands.registerCommand("references-view.copyPath",e=>{e instanceof s.FileItem&&("file"===e.uri.scheme?r.env.clipboard.writeText(e.uri.fsPath):r.env.clipboard.writeText(e.uri.toString(!0)))}),r.commands.registerCommand("references-view.pickFromHistory",()=>i(this,void 0,void 0,function*(){const e=[...n].map(e=>({label:e.word,description:`${r.workspace.asRelativePath(e.uri)} • ${e.line}`,item:e})),t=yield r.window.showQuickPick(e,{placeHolder:"Select previous reference search"});t&&(yield p(t.item))})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.EditorHighlights=class{constructor(){this._decorationType=i.window.createTextEditorDecorationType({backgroundColor:new i.ThemeColor("editor.findMatchHighlightBackground"),rangeBehavior:i.DecorationRangeBehavior.ClosedClosed,overviewRulerLane:i.OverviewRulerLane.Center,overviewRulerColor:new i.ThemeColor("editor.findMatchHighlightBackground")}),this._ignore=new Set}setModel(e){this._model=e,this._ignore.clear(),this._modelListener&&this._modelListener.dispose(),e?(this.show(),this._modelListener=i.workspace.onDidChangeTextDocument(t=>{this._ignore.add(e.get(t.document.uri))})):this.hide()}show(){const{activeTextEditor:e}=i.window;if(!e||!this._model)return;const t=this._model.get(e.document.uri);t&&!this._ignore.has(t)&&e.setDecorations(this._decorationType,t.results.map(e=>e.location.range))}hide(){const{activeTextEditor:e}=i.window;e&&e.setDecorations(this._decorationType,[])}refresh(){this.hide(),this.show()}}}]);
//# sourceMappingURL=extension.js.map